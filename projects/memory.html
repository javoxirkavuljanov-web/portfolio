<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Memory Card Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            position: relative;
        }

        .title {
            font-size: 3rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255,255,255,0.1);
            padding: 10px 15px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
        }

        .control-group label {
            color: white;
            font-weight: 500;
        }

        select, button {
            padding: 8px 15px;
            border: none;
            border-radius: 20px;
            background: rgba(255,255,255,0.9);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        select:hover, button:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .stat-box {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            padding: 15px 25px;
            border-radius: 15px;
            text-align: center;
            color: white;
            min-width: 120px;
            transition: all 0.3s ease;
        }

        .stat-box:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.2);
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .game-board {
            display: grid;
            gap: 10px;
            justify-content: center;
            margin: 30px auto;
            max-width: 800px;
            perspective: 1000px;
        }

        .game-board.size-4x4 { grid-template-columns: repeat(4, 1fr); }
        .game-board.size-6x6 { grid-template-columns: repeat(6, 1fr); }
        .game-board.size-8x8 { grid-template-columns: repeat(8, 1fr); }

        .card {
            aspect-ratio: 1;
            border-radius: 12px;
            cursor: pointer;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s ease;
            min-width: 60px;
            max-width: 120px;
            width: 100%;
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card.matched {
            opacity: 0.7;
            transform: scale(0.95) rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 12px;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .card-back {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: 3px solid rgba(255,255,255,0.3);
        }

        .card-front {
            transform: rotateY(180deg);
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            color: #2d3436;
            border: 3px solid rgba(255,255,255,0.5);
        }

        .card:hover:not(.flipped):not(.matched) {
            transform: translateY(-5px) rotateX(10deg);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        .particle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #feca57;
            border-radius: 50%;
            animation: particle-float 2s ease-out forwards;
        }

        @keyframes particle-float {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(0);
            }
        }

        .combo-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
            padding: 15px 30px;
            border-radius: 20px;
            font-size: 1.5rem;
            font-weight: bold;
            z-index: 1001;
            opacity: 0;
            animation: combo-popup 1s ease-out;
            pointer-events: none;
        }

        @keyframes combo-popup {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
        }

        .victory-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .victory-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .victory-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            color: white;
            max-width: 500px;
            transform: scale(0.8);
            transition: all 0.3s ease;
        }

        .victory-modal.show .victory-content {
            transform: scale(1);
        }

        .victory-title {
            font-size: 2.5rem;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .time-bar {
            width: 100%;
            height: 10px;
            background: rgba(255,255,255,0.2);
            border-radius: 5px;
            margin: 15px 0;
            overflow: hidden;
        }

        .time-progress {
            height: 100%;
            background: linear-gradient(90deg, #00b894, #feca57, #e17055);
            border-radius: 5px;
            transition: width 1s linear;
        }

        .hint-button {
            background: linear-gradient(45deg, #00b894, #00cec9);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .hint-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .hint-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .settings-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            color: white;
        }

        .theme-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .theme-option {
            padding: 8px 15px;
            border: 2px solid transparent;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.1);
        }

        .theme-option.active {
            border-color: #feca57;
            background: rgba(254,202,87,0.2);
        }

        @media (max-width: 768px) {
            .title { font-size: 2rem; }
            .controls { flex-direction: column; }
            .stats { flex-direction: column; align-items: center; }
            .card { min-width: 50px; }
            .settings-panel { position: relative; top: 0; right: 0; margin: 20px auto; }
        }

        .pulse {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .shake {
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1 class="title">üß† Memory Master</h1>
        </div>

        <div class="controls">
            <div class="control-group">
                <label for="gridSize">Grid Size:</label>
                <select id="gridSize">
                    <option value="4x4">4√ó4 (Easy)</option>
                    <option value="6x6">6√ó6 (Medium)</option>
                    <option value="8x8">8√ó8 (Hard)</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="gameMode">Mode:</label>
                <select id="gameMode">
                    <option value="classic">Classic</option>
                    <option value="timed">Time Challenge</option>
                </select>
            </div>
            
            <button id="newGame">üéÆ New Game</button>
            <button id="hintButton" class="hint-button">üí° Hint (3)</button>
        </div>

        <div class="stats">
            <div class="stat-box">
                <div class="stat-label">Moves</div>
                <div class="stat-value" id="moveCount">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Matches</div>
                <div class="stat-value" id="matchCount">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Time</div>
                <div class="stat-value" id="timeCount">00:00</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Score</div>
                <div class="stat-value" id="scoreCount">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Combo</div>
                <div class="stat-value" id="comboCount">√ó1</div>
            </div>
        </div>

        <div class="time-bar" id="timeBar" style="display: none;">
            <div class="time-progress" id="timeProgress"></div>
        </div>

        <div class="game-board" id="gameBoard"></div>

        <div class="settings-panel">
            <h3>üé® Theme</h3>
            <div class="theme-selector">
                <div class="theme-option active" data-theme="animals">üê± Animals</div>
                <div class="theme-option" data-theme="space">üöÄ Space</div>
                <div class="theme-option" data-theme="food">üçï Food</div>
                <div class="theme-option" data-theme="tech">üíª Tech</div>
            </div>
            
            <div style="margin-top: 20px;">
                <label>
                    <input type="checkbox" id="soundToggle" checked> üîä Sound Effects
                </label>
            </div>
        </div>
    </div>

    <div class="particles" id="particles"></div>
    
    <div class="victory-modal" id="victoryModal">
        <div class="victory-content">
            <div class="victory-title">üéâ Victory!</div>
            <div id="victoryStats"></div>
            <div style="margin-top: 20px;">
                <button onclick="startNewGame()">üéÆ Play Again</button>
                <button onclick="closeVictoryModal()">‚ùå Close</button>
            </div>
        </div>
    </div>

    <script>
        class MemoryGame {
            constructor() {
                this.gridSize = '4x4';
                this.gameMode = 'classic';
                this.theme = 'animals';
                this.cards = [];
                this.flippedCards = [];
                this.matchedPairs = 0;
                this.moves = 0;
                this.startTime = null;
                this.gameTimer = null;
                this.timeLimit = 120; // seconds
                this.score = 0;
                this.combo = 1;
                this.hintsRemaining = 3;
                this.soundEnabled = true;
                
                this.themes = {
                    animals: ['üê±', 'üê∂', 'ü¶ä', 'üê∫', 'ü¶ù', 'üê∏', 'üêØ', 'ü¶Å', 'üêµ', 'üê®', 'üêº', 'üê∑', 'üêÆ', 'ü¶Ñ', 'üêî', 'üêß', 'ü¶Ö', 'ü¶Ü', 'üêô', 'ü¶Ä', 'üê†', 'üê¢', 'ü¶ã', 'üêù', 'üêû', 'üï∑Ô∏è', 'ü¶ó', 'üêö', 'üêå', 'ü¶é', 'üêç', 'üêä'],
                    space: ['üåü', '‚≠ê', 'üåô', '‚òÄÔ∏è', 'ü™ê', 'üåç', 'üåï', 'üåë', '‚òÑÔ∏è', 'üõ∏', 'üöÄ', 'üëΩ', 'üåå', '‚ú®', 'üí´', 'üî≠', 'üõ∞Ô∏è', 'üå†', 'üåñ', 'üåó', 'üåò', 'üåí', 'üåì', 'üåî', 'üåú', 'üåõ', 'üåù', 'üåö', 'üåû', '‚ö°', 'üí•', 'üåà'],
                    food: ['üçé', 'üçå', 'üçá', 'üçì', 'üçä', 'ü•ù', 'üçë', 'üçí', 'ü•≠', 'üçç', 'ü••', 'ü•ë', 'üçÖ', 'ü•ï', 'üåΩ', 'ü•í', 'ü•¨', 'ü•¶', 'üßÑ', 'üßÖ', 'üçÑ', 'ü•ú', 'üå∞', 'üçû', 'ü•ê', 'ü•ñ', 'ü•®', 'üßÄ', 'üçØ', 'ü•õ', '‚òï', 'üçï'],
                    tech: ['üíª', 'üì±', '‚åö', 'üñ•Ô∏è', '‚å®Ô∏è', 'üñ±Ô∏è', 'üíæ', 'üíø', 'üìÄ', 'üîå', 'üîã', 'üì∑', 'üìπ', 'üì∫', 'üìª', 'üéÆ', 'üïπÔ∏è', 'üí°', 'üî¶', 'üîç', 'üîí', 'üîë', '‚öôÔ∏è', 'üîß', 'üî®', '‚ö°', 'üì°', 'üõ∞Ô∏è', 'üöÅ', '‚úàÔ∏è', 'üöÄ', 'üõ∏']
                };
                
                this.initializeGame();
                this.setupEventListeners();
            }

            initializeGame() {
                this.updateDisplay();
                this.createBoard();
            }

            setupEventListeners() {
                document.getElementById('gridSize').addEventListener('change', (e) => {
                    this.gridSize = e.target.value;
                    this.startNewGame();
                });

                document.getElementById('gameMode').addEventListener('change', (e) => {
                    this.gameMode = e.target.value;
                    this.startNewGame();
                });

                document.getElementById('newGame').addEventListener('click', () => {
                    this.startNewGame();
                });

                document.getElementById('hintButton').addEventListener('click', () => {
                    this.useHint();
                });

                document.getElementById('soundToggle').addEventListener('change', (e) => {
                    this.soundEnabled = e.target.checked;
                });

                document.querySelectorAll('.theme-option').forEach(option => {
                    option.addEventListener('click', (e) => {
                        document.querySelectorAll('.theme-option').forEach(o => o.classList.remove('active'));
                        e.target.classList.add('active');
                        this.theme = e.target.dataset.theme;
                        this.startNewGame();
                    });
                });

                // Keyboard navigation
                document.addEventListener('keydown', (e) => {
                    this.handleKeyboard(e);
                });
            }

            handleKeyboard(e) {
                if (e.code === 'Space') {
                    e.preventDefault();
                    this.useHint();
                } else if (e.code === 'KeyN') {
                    this.startNewGame();
                }
            }

            createBoard() {
                const board = document.getElementById('gameBoard');
                board.innerHTML = '';
                board.className = `game-board size-${this.gridSize}`;

                const [rows, cols] = this.gridSize.split('x').map(Number);
                const totalCards = rows * cols;
                const pairsNeeded = totalCards / 2;
                
                // Get theme symbols
                const themeSymbols = this.themes[this.theme];
                const selectedSymbols = this.shuffleArray([...themeSymbols]).slice(0, pairsNeeded);
                
                // Create pairs
                this.cards = [...selectedSymbols, ...selectedSymbols];
                this.cards = this.shuffleArray(this.cards);

                // Create card elements
                this.cards.forEach((symbol, index) => {
                    const card = this.createCard(symbol, index);
                    board.appendChild(card);
                });
            }

            createCard(symbol, index) {
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.index = index;
                card.dataset.symbol = symbol;
                card.tabIndex = 0;
                
                card.innerHTML = `
                    <div class="card-face card-back">‚ùì</div>
                    <div class="card-face card-front">${symbol}</div>
                `;

                card.addEventListener('click', () => this.flipCard(index));
                card.addEventListener('keydown', (e) => {
                    if (e.code === 'Enter' || e.code === 'Space') {
                        e.preventDefault();
                        this.flipCard(index);
                    }
                });

                return card;
            }

            flipCard(index) {
                if (this.flippedCards.length >= 2) return;
                
                const card = document.querySelector(`[data-index="${index}"]`);
                if (card.classList.contains('flipped') || card.classList.contains('matched')) return;

                card.classList.add('flipped');
                this.flippedCards.push(index);
                this.playSound('flip');

                if (this.flippedCards.length === 2) {
                    this.moves++;
                    this.updateDisplay();
                    
                    setTimeout(() => {
                        this.checkMatch();
                    }, 1000);
                }

                if (!this.startTime) {
                    this.startGame();
                }
            }

            checkMatch() {
                const [index1, index2] = this.flippedCards;
                const card1 = document.querySelector(`[data-index="${index1}"]`);
                const card2 = document.querySelector(`[data-index="${index2}"]`);
                
                const symbol1 = card1.dataset.symbol;
                const symbol2 = card2.dataset.symbol;

                if (symbol1 === symbol2) {
                    // Match found
                    card1.classList.add('matched');
                    card2.classList.add('matched');
                    this.matchedPairs++;
                    
                    // Calculate score
                    const baseScore = 100;
                    const timeBonus = this.gameMode === 'timed' ? Math.max(0, this.timeLimit - this.getElapsedTime()) : 0;
                    const moveBonus = Math.max(0, 50 - this.moves);
                    this.score += (baseScore + timeBonus + moveBonus) * this.combo;
                    
                    // Increase combo
                    this.combo = Math.min(this.combo + 0.5, 5);
                    
                    this.createParticles(card1);
                    this.createParticles(card2);
                    this.showCombo();
                    this.playSound('match');
                    
                    // Check if game is complete
                    const totalPairs = this.cards.length / 2;
                    if (this.matchedPairs === totalPairs) {
                        setTimeout(() => {
                            this.gameComplete();
                        }, 1000);
                    }
                } else {
                    // No match
                    card1.classList.remove('flipped');
                    card2.classList.remove('flipped');
                    card1.classList.add('shake');
                    card2.classList.add('shake');
                    
                    setTimeout(() => {
                        card1.classList.remove('shake');
                        card2.classList.remove('shake');
                    }, 500);
                    
                    // Reset combo
                    this.combo = 1;
                    this.playSound('miss');
                }

                this.flippedCards = [];
                this.updateDisplay();
            }

            createParticles(card) {
                const rect = card.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;

                for (let i = 0; i < 10; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = centerX + 'px';
                    particle.style.top = centerY + 'px';
                    particle.style.background = `hsl(${Math.random() * 360}, 70%, 60%)`;
                    
                    const angle = (Math.PI * 2 * i) / 10;
                    const velocity = 50 + Math.random() * 50;
                    
                    particle.style.setProperty('--dx', Math.cos(angle) * velocity + 'px');
                    particle.style.setProperty('--dy', Math.sin(angle) * velocity + 'px');
                    
                    document.getElementById('particles').appendChild(particle);
                    
                    setTimeout(() => {
                        particle.remove();
                    }, 2000);
                }
            }

            showCombo() {
                if (this.combo > 1) {
                    const comboEl = document.createElement('div');
                    comboEl.className = 'combo-indicator';
                    comboEl.textContent = `${this.combo.toFixed(1)}√ó COMBO!`;
                    document.body.appendChild(comboEl);
                    
                    setTimeout(() => {
                        comboEl.remove();
                    }, 1000);
                }
            }

            useHint() {
                if (this.hintsRemaining <= 0) return;
                
                this.hintsRemaining--;
                
                // Find an unmatched card
                const unmatchedCards = Array.from(document.querySelectorAll('.card:not(.matched)'));
                if (unmatchedCards.length > 0) {
                    const randomCard = unmatchedCards[Math.floor(Math.random() * unmatchedCards.length)];
                    randomCard.classList.add('pulse');
                    
                    setTimeout(() => {
                        randomCard.classList.remove('pulse');
                    }, 2000);
                }
                
                this.updateDisplay();
                this.playSound('hint');
            }

            startGame() {
                this.startTime = Date.now();
                
                if (this.gameMode === 'timed') {
                    document.getElementById('timeBar').style.display = 'block';
                    this.startTimer();
                }
            }

            startTimer() {
                const timeBar = document.getElementById('timeProgress');
                let elapsed = 0;
                
                this.gameTimer = setInterval(() => {
                    elapsed++;
                    const remaining = this.timeLimit - elapsed;
                    const percentage = (remaining / this.timeLimit) * 100;
                    
                    timeBar.style.width = `${Math.max(0, percentage)}%`;
                    
                    if (remaining <= 0) {
                        this.gameOver();
                    }
                }, 1000);
            }

            gameOver() {
                clearInterval(this.gameTimer);
                alert('‚è∞ Time\'s up! Game Over!');
                this.startNewGame();
            }

            gameComplete() {
                clearInterval(this.gameTimer);
                
                const finalTime = this.getElapsedTime();
                const efficiency = Math.round((this.matchedPairs / this.moves) * 100);
                
                const modal = document.getElementById('victoryModal');
                const stats = document.getElementById('victoryStats');
                
                stats.innerHTML = `
                    <div style="margin: 15px 0;">
                        <div><strong>Final Score:</strong> ${this.score.toLocaleString()}</div>
                        <div><strong>Time:</strong> ${this.formatTime(finalTime)}</div>
                        <div><strong>Moves:</strong> ${this.moves}</div>
                        <div><strong>Efficiency:</strong> ${efficiency}%</div>
                        <div><strong>Max Combo:</strong> √ó${this.combo.toFixed(1)}</div>
                    </div>
                `;
                
                modal.classList.add('show');
                this.playSound('victory');
                
                // Save high score
                this.saveHighScore();
            }

            saveHighScore() {
                const key = `highScore_${this.gridSize}_${this.gameMode}`;
                const currentHigh = parseInt(localStorage.getItem(key) || '0');
                
                if (this.score > currentHigh) {
                    localStorage.setItem(key, this.score.toString());
                }
            }

            getElapsedTime() {
                return this.startTime ? Math.floor((Date.now() - this.startTime) / 1000) : 0;
            }

            formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }

            updateDisplay() {
                document.getElementById('moveCount').textContent = this.moves;
                document.getElementById('matchCount').textContent = this.matchedPairs;
                document.getElementById('timeCount').textContent = this.formatTime(this.getElapsedTime());
                document.getElementById('scoreCount').textContent = this.score.toLocaleString();
                document.getElementById('comboCount').textContent = `√ó${this.combo.toFixed(1)}`;
                
                const hintButton = document.getElementById('hintButton');
                hintButton.textContent = `üí° Hint (${this.hintsRemaining})`;
                hintButton.disabled = this.hintsRemaining <= 0;
            }

            startNewGame() {
                clearInterval(this.gameTimer);
                
                this.flippedCards = [];
                this.matchedPairs = 0;
                this.moves = 0;
                this.startTime = null;
                this.score = 0;
                this.combo = 1;
                this.hintsRemaining = 3;
                
                document.getElementById('timeBar').style.display = 'none';
                document.getElementById('particles').innerHTML = '';
                
                this.createBoard();
                this.updateDisplay();
            }

            shuffleArray(array) {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            }

            playSound(type) {
                if (!this.soundEnabled) return;
                
                // Create audio context for sound effects
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                const frequencies = {
                    flip: 440,
                    match: 660,
                    miss: 220,
                    hint: 880,
                    victory: [523, 659, 784, 1047]
                };
                
                if (type === 'victory') {
                    // Play victory melody
                    frequencies.victory.forEach((freq, i) => {
                        setTimeout(() => {
                            this.playTone(audioContext, freq, 0.3);
                        }, i * 150);
                    });
                } else {
                    this.playTone(audioContext, frequencies[type], 0.1);
                }
            }

            playTone(audioContext, frequency, duration) {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            }
        }

        // Initialize game
        let game;

        document.addEventListener('DOMContentLoaded', () => {
            game = new MemoryGame();
        });

        // Global functions for modal
        function startNewGame() {
            game.startNewGame();
            closeVictoryModal();
        }

        function closeVictoryModal() {
            document.getElementById('victoryModal').classList.remove('show');
        }

        // Update timer display
        setInterval(() => {
            if (game && game.startTime) {
                game.updateDisplay();
            }
        }, 1000);

        // Performance monitoring
        let frameCount = 0;
        let lastTime = performance.now();

        function monitorPerformance() {
            frameCount++;
            const currentTime = performance.now();
            
            if (currentTime - lastTime >= 1000) {
                const fps = Math.round((frameCount * 1000) / (currentTime - lastTime));
                
                // If FPS drops below 30, reduce visual effects
                if (fps < 30) {
                    document.querySelectorAll('.card').forEach(card => {
                        card.style.transition = 'transform 0.3s ease';
                    });
                }
                
                frameCount = 0;
                lastTime = currentTime;
            }
            
            requestAnimationFrame(monitorPerformance);
        }

        monitorPerformance();

        // Add daily challenge system
        function getDailyChallenge() {
            const today = new Date().toDateString();
            const challenges = [
                { size: '4x4', mode: 'timed', theme: 'animals', target: 2000 },
                { size: '6x6', mode: 'classic', theme: 'space', target: 5000 },
                { size: '8x8', mode: 'timed', theme: 'food', target: 10000 },
                { size: '4x4', mode: 'classic', theme: 'tech', target: 1500 }
            ];
            
            const dayIndex = new Date().getDate() % challenges.length;
            return challenges[dayIndex];
        }

        // Statistics tracking
        class GameStats {
            constructor() {
                this.stats = this.loadStats();
            }

            loadStats() {
                return JSON.parse(localStorage.getItem('memoryGameStats') || '{}');
            }

            saveStats() {
                localStorage.setItem('memoryGameStats', JSON.stringify(this.stats));
            }

            recordGame(gridSize, mode, score, time, moves) {
                const key = `${gridSize}_${mode}`;
                if (!this.stats[key]) {
                    this.stats[key] = {
                        gamesPlayed: 0,
                        totalScore: 0,
                        bestScore: 0,
                        bestTime: Infinity,
                        averageMoves: 0,
                        totalMoves: 0
                    };
                }

                const stat = this.stats[key];
                stat.gamesPlayed++;
                stat.totalScore += score;
                stat.bestScore = Math.max(stat.bestScore, score);
                stat.bestTime = Math.min(stat.bestTime, time);
                stat.totalMoves += moves;
                stat.averageMoves = stat.totalMoves / stat.gamesPlayed;

                this.saveStats();
            }

            getStats(gridSize, mode) {
                const key = `${gridSize}_${mode}`;
                return this.stats[key] || null;
            }
        }

        // Achievement system
        const achievements = {
            'first_win': { name: 'First Victory', description: 'Complete your first game', icon: 'üèÜ' },
            'speed_demon': { name: 'Speed Demon', description: 'Complete 4x4 in under 30 seconds', icon: '‚ö°' },
            'perfectionist': { name: 'Perfectionist', description: 'Complete a game with 100% efficiency', icon: 'üíØ' },
            'combo_master': { name: 'Combo Master', description: 'Achieve a 5x combo multiplier', icon: 'üî•' },
            'marathon': { name: 'Marathon Runner', description: 'Complete 10 games in a row', icon: 'üèÉ' },
            'theme_collector': { name: 'Theme Collector', description: 'Play with all themes', icon: 'üé®' }
        };

        // Add touch gesture support
        let touchStartX = 0;
        let touchStartY = 0;

        document.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        });

        document.addEventListener('touchend', (e) => {
            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;
            
            const diffX = touchStartX - touchEndX;
            const diffY = touchStartY - touchEndY;
            
            // Swipe gestures for navigation
            if (Math.abs(diffX) > Math.abs(diffY)) {
                if (diffX > 50) {
                    // Swipe left - previous theme
                    const themes = ['animals', 'space', 'food', 'tech'];
                    const current = themes.indexOf(game.theme);
                    const next = current > 0 ? current - 1 : themes.length - 1;
                    document.querySelector(`[data-theme="${themes[next]}"]`).click();
                } else if (diffX < -50) {
                    // Swipe right - next theme
                    const themes = ['animals', 'space', 'food', 'tech'];
                    const current = themes.indexOf(game.theme);
                    const next = current < themes.length - 1 ? current + 1 : 0;
                    document.querySelector(`[data-theme="${themes[next]}"]`).click();
                }
            }
        });

        // Add accessibility improvements
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeVictoryModal();
            }
        });

        // Auto-save game state
        function saveGameState() {
            if (!game) return;
            
            const gameState = {
                gridSize: game.gridSize,
                gameMode: game.gameMode,
                theme: game.theme,
                cards: game.cards,
                moves: game.moves,
                matchedPairs: game.matchedPairs,
                score: game.score,
                startTime: game.startTime
            };
            
            localStorage.setItem('memoryGameState', JSON.stringify(gameState));
        }

        function loadGameState() {
            const saved = localStorage.getItem('memoryGameState');
            if (saved && game) {
                const state = JSON.parse(saved);
                Object.assign(game, state);
                game.updateDisplay();
            }
        }

        // Save state periodically
        setInterval(saveGameState, 10000);

        // Add progressive web app features
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(() => {
                console.log('Service worker registration failed');
            });
        }

        // Dynamic difficulty adjustment
        function adjustDifficulty() {
            if (!game) return;
            
            const efficiency = game.matchedPairs > 0 ? (game.matchedPairs / game.moves) * 100 : 0;
            
            if (efficiency > 90) {
                // Player is doing too well, suggest harder difficulty
                console.log('Consider increasing difficulty');
            } else if (efficiency < 30) {
                // Player struggling, suggest easier difficulty
                console.log('Consider decreasing difficulty');
            }
        }

        // Network connectivity handling
        window.addEventListener('online', () => {
            console.log('Connection restored');
        });

        window.addEventListener('offline', () => {
            console.log('Connection lost - game continues offline');
        });
    </script>
</body>
</html>